# 스프링 핵심 원리 이해 3 - 스프링 컨테이너와 스프링 빈

### 스프링 컨테이너 생성
**스프링 컨테이너가 생성되는 과정**
```java
ApplicationContext applicationContext = 
        new AnnotationConfigApplicationContext(AppConfig.class);
```
* `ApplicationContext`를 스프링 컨테이너라고 한다. 
* `ApplicationContext`는 인터페이스이기 때문에 다형성이 적용되어있다. 

1. 스프링 컨테이너 생성
   * `new AnnotationConfigApplicationContext(AppConfig.class)`
   * 스프링 컨테이너를 생성할 때는 **구성 정보**를 지정해주어야한다. ➡️ `AppConfig.class`
2. 스프링 빈 등록
    * 스프링 컨테이너는 파라미터로 넘어온 설정 클래스 정보를 사용해서 스프링 빈 등록
    * 빈 이름은 항상 **다른 이름**을 부여해야한다. 

3. 스프링 빈 의존관계 설정 - 준비
4. 스프링 빈 의존관계 설정 - 완료
   * 스프링 컨테이너는 설정 정보를 참고해서 의존관계를 주입(DI)한다. 
   * 싱글톤 컨테이너

<br />

### 컨테이너에 등록된 모든 빈 조회
* 모든 bean 출력
  * `ac.getBeanDefinitionNames()` : 스프링에 등록된 모든 빈 이름 조회
  * `ac.getBean()` : 빈 이름으로 빈 객체를 조회
* 애플리케이션 bean 출력
  * `getRole()`로 구분
  * `ROLE_APPLICATION` : 일반적으로 사용자가 정의한 빈
  * `ROLE_INFRASTRUCTURE` : 스프링이 내부에서 사용하는 빈 

<br />

### 스프링 빈 조회 - 기본

* `ac.getBean(beanName, type)` or `ac.getBean(type)`
* 조회 대상 스프링 빈이 없으면 예외 발생
  * `org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'xxxxx' available` 에러 발생

### 스프링 빈 조회 - 동일한 타입이 둘 이상
* 타입으로 조회 시 같은 타입의 스프링빈이 둘 이상이면 오류가 발생한다. 
* rg.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'Hello.core.member.MemberRepository' available: expected single matching bean but found 2: memberRepository1,memberRepository
  > solution💡 빈 이름을 지정
* `ac.getBeansOfType()` : 해당 타입의 모든 빈 조회

### 스프링 빈 조회 - 상속관계 
* 부모 타입으로 조회하면, 자식 타입도 함께 조회된다. 
* 자바 객체의 최상위 `Object`타입으로 조회하면 모든 스프링 빈이 조회된다. 

### BeanFactory와 ApplicationContext
> BeanFactory ➡️ ApplicationContext ➡ AnnotationConfig
**BeanFactory**
* 스프링 컨테이너의 최상위 인터페이스
* 스프링 빈을 관리하고 조회하는 역할
* `getBean()`을 제공한다.

**ApplicationContext**
* BeanFactory 기능을 모두 상속받아서 제공
* 빈을 관리하고 검색하는 기능을 BeanFactory가 제공해주는데, 둘의 차이?
* application을 개발할 때는 반은 관리하고 반은 조회하는 기능은 물론이고 수 많은 부가 기능이 필요
* ApplicationContext가 제공하는 부가 가능
  * 메세지 소스를 활용한 국제화 기능: 접속 국가에 맞는 언어 출력
  * 환경변수: 로컬, 개발, 운영등을 구분해서 처리
  * 애플리케이션 이벤트
  * 편리한 리소스 조회 

<br />

### 스프링 빈 설정 메타 정보 - BeanDefinition
* `BeanClassName` : 생성할 빈의 클래스 명(자바 설정 처럼 팩토리 역할의 빈을 사용하면 없음)
* `factoryBeanName` : 팩토리 역할의 빈을 사용할 경우 이름, 예) appConfig
* `factoryMethodName` : 빈을 생성할 팩토리 메서드 지정, 예) memberService
* `Scope` : 싱글톤(기본값)
* `lazyInit` : 스프링 컨테이너를 생성할 때 빈을 생성하는 것이 아니라, 실제 빈을 사용할 때 까지 최대한 생성을 지연처리하는지 여부
* `InitMethodName` : 빈의 생명주기가 끝나서 제거하기 직전에 호출되는 메서드 명
* `DestroyMethodName` : 빈의 생명주기가 끝나서 제거하기 직전에 호출되는 메서드 명
* `Constructor arguments, Properties` : 의존관계 주입에서 사용한다. (자바 설정 처럼 팩토리 역할의 빈을 사용하면 없음)

> 스프링이 다양한 형태의 설정 정보를 BeanDefinition으로 추상화해서 사용한다. 